<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
        
<mapper namespace="com.gooddog.mapper.GalleryMapper">

	<!-- 갤러리 글 전체보기 -->
	<select id="galleryList" resultType="GalleryVO">
		<![CDATA[
		SELECT * FROM gallery ORDER BY gal_date asc
		]]>
	</select>
	<!-- 갤러리 글 상세보기-->
	<select id="galNoList" resultType="hashmap" parameterType="int">
		<![CDATA[
		SELECT * FROM gallery g inner join user u on g.user_id=u.user_id WHERE gal_no=#{no}
		]]>
	</select>
	<!-- 갤러리 글 insert -->
	<insert id="galInsert" parameterType="GalleryVO">
		INSERT INTO gallery(gal_no,user_id,gal_name,gal_img,gal_content,gal_tag,gal_date,gal_heart,gal_cnt)
		VALUES(null,'a123',#{gal_name},#{gal_img},#{gal_name},#{gal_tag},now(),0,0)
		
	</insert>
	
	<!-- 갤러리 글 수정 -->
	<update id="galUpdate" parameterType="GalleryVO">
		UPDATE gallery SET gal_name=#{gal_name},gal_tag=#{gal_tag}
		<choose>
		<when test="gal_name != null">
			,gal_img = #{gal_img}
		</when>
		<otherwise>
			,gal_img = 'insta_dog_04.jpg'
		</otherwise>
		</choose>
		WHERE gal_no=#{gal_no}

	</update>
	<!-- 좋아요 1개 up -->
	<update id="galHeartUp" parameterType="GalleryVO">
		<![CDATA[
		UPDATE gallery SET gal_heart=gal_heart+1 WHERE gal_no=#{gal_no}
		]]>
	</update>
	<!-- 좋아요 1개 down -->
	<update id="galHeartDown" parameterType="GalleryVO">
		<![CDATA[
		UPDATE gallery SET gal_heart=gal_heart-1 WHERE gal_no=#{gal_no}
		]]>
	</update>
	<!-- 갤러리 글 삭제 -->
	<delete id="galDelete"  parameterType="int">
		<![CDATA[
		DELETE FROM gallery WHERE gal_no=#{gal_no}
		]]>
	</delete>
	
	<!-- 리뷰 조회 -->
	<select id="reviewList" parameterType="GalleryVO" resultType="hashmap">
		<![CDATA[
		SELECT * FROM galre g inner join user u on g.user_id = u.user_id WHERE gal_no=#{gal_no}
		]]>
	</select>
	
	<!-- 리뷰 개수 조회 -->
	<select id="reviewCount" parameterType="GalleryVO" resultType="int">
		<![CDATA[
		SELECT count(*) 
		FROM galre
		WHERE gal_no=#{gal_no}
		]]>
	</select>
	
	
</mapper>   